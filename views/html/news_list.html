<html lang="en">
<head>
    <meta charset="utf-8" />
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <title>新闻</title>
    <link rel="stylesheet" href="/css/main.css">
</head>

<body>
<div class="page-shell">
    <div class="toolbar">
        <a id="issue_bnt" class="btn btn-primary" style="display: none;" onclick="issueNews();">发布新闻</a>
        <a href="/login" id="login" class="btn btn-ghost" style="display: none;">登录</a>
        <a href="/modify_pass" id="user_name" class="pill" style="display: none;"></a>
        <a id="log_out" class="btn btn-ghost" style="display: none;" onclick="logout();">退出</a>
    </div>

    <div class="card">
        <div class="hero-title">今日热点</div>
        <div class="hero-subtitle">实时掌握最新资讯，随时分享你的观点</div>
        <table class="table">
            <thead>
            <tr>
                <th>标题</th>
                <th>作者</th>
                <th>发布时间</th>
            </tr>
            </thead>
            <tbody>
            {{range .data}}
            <tr>
                <td><a href="/news/{{.Id}}">{{.Title}}</a></td>
                <td>{{.UserName}}</td>
                <td>{{.ViewPostTime}}</td>
            </tr>
            {{end}}
            </tbody>
        </table>
        <div class="pagination">
            <button onclick="prev_page();">上一页</button>
            <div>第 {{.page}} 页 · 共 {{.total}} 篇</div>
            <button onclick="next_page();">下一页</button>
        </div>
    </div>
</div>
<span style="display: none;"><input id="page_no" value="{{.page}}"></input></span>

<script>
    // 下一页
    function next_page() {
        var pageNo = document.querySelector("#page_no").value;
        var url = "/news?page_size=3&page_no=" + (parseInt(pageNo) + 1).toString();
        window.location.assign(url);
    };

    // 上一页
    function prev_page() {
        var pageNo = document.querySelector("#page_no").value;
        if (parseInt(pageNo) > 1) {
            var url = "/news?page_size=3&page_no=" + (parseInt(pageNo) - 1).toString();
            window.location.assign(url);
        }
    };

    // 发布新闻
    function issueNews() {
        window.location.href = "/news/issue";
    }

    // 退出登录
    function logout() {
        $.ajax({
            url: "/logout/submit",
            method: "GET",
            success: function (result) {
                // 注销后刷新页面以更新登录状态
                window.location.reload();
            }
        });
    };

    // 页面加载完成后检查用户登录状态
    $(document).ready(function () {
        $.ajax({
            url: "/user",  // 请求当前用户信息
            method: "GET",
            success: function (result) {
                if (result.Name) {  // 如果用户已登录
                    // 显示“发布新闻”按钮和“退出”按钮
                    document.querySelector("#issue_bnt").style.display = "inline";
                    document.querySelector("#user_name").innerText = result.Name;
                    document.querySelector("#user_name").style.display = "inline";
                    document.querySelector("#login").style.display = "none";
                    document.querySelector("#log_out").style.display = "inline";
                } else {
                    document.querySelector("#login").style.display = "inline";
                    document.querySelector("#user_name").style.display = "none";
                    document.querySelector("#log_out").style.display = "none";
                    document.querySelector("#issue_bnt").style.display = "none";
                }
            },
            error: function () {
                // 未登录或请求异常时显示登录按钮
                document.querySelector("#login").style.display = "inline";
                document.querySelector("#user_name").style.display = "none";
                document.querySelector("#log_out").style.display = "none";
                document.querySelector("#issue_bnt").style.display = "none";
            }
        });
    });
</script>
</body>
</html>
